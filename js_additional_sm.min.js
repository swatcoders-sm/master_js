$(function(){var t;function e(){$(".btn-wishlist").on("click",function(){var t=$(this).prev().data("productcode").toString();if("none"==$(this).children(".inWishlist").css("display"))null===localStorage.getItem("Wishlist")?((e=[]).push(t),localStorage.setItem("Wishlist",JSON.stringify(e))):((e=JSON.parse(localStorage.getItem("Wishlist"))).push(t),localStorage.setItem("Wishlist",JSON.stringify(e)));else if(null!=localStorage.getItem("Wishlist")){var e,a=(e=JSON.parse(localStorage.getItem("Wishlist"))).indexOf(t);a>-1&&(e.splice(a,1),localStorage.setItem("Wishlist",JSON.stringify(e)))}})}$(".pageType-ProductPage").length?t="PDP":$(".page-search").length||$(".pageType-CategoryPage").length?t="PLP":$(".page-account-wishlist").length?t="Wishlist":"/"==location.pathname?t="Homepage":$(".page-cartPage").length?t="Cart":location.pathname.indexOf("payment-method")>-1&&(t="Payment"),location.hostname;var a,l,o,i,s,n,r,c=dataLayer.find(t=>"klarnaVariables"===t.event).klarnaFooter,d=dataLayer.find(t=>"klarnaVariables"===t.event).klarnaPDP,p=dataLayer.find(t=>"klarnaVariables"===t.event).klarnaCart;function m(){window.KlarnaOnsiteService=window.KlarnaOnsiteService||[],window.KlarnaOnsiteService.push({eventName:"refresh-placements"})}if("/klarna"==location.pathname&&m(),!0===c&&$(".footer__payments").prepend('<span><img src="/medias/Klarna-PaymentBadge-OutsideCheckout-Pink-1-.png?context=bWFzdGVyfHJvb3R8NzQ3MHxpbWFnZS9wbmd8aDljL2g2NS85MzAxMDI2NTA0NzM0LnBuZ3xjN2MyM2FmYjIzNWI5NjdlNDcxZDlmNzNiNjFiZGVhYjg5NTcxYjQ0Yjg3NTdmZmM4MzYwYmViMzUxMTY4Yjky" style="width: 56px; vertical-align: top;"></span>'),$(".owl-carousel.etCustServeMsgCarousel").owlCarousel({loop:!0,margin:0,autoPlay:!0,autoPlayTimeout:1e3,navigation:!0,itemsDesktop:[5e3,2],itemsDesktopSmall:[1024,2],itemsTablet:[768,1],itemsMobile:[480,1]}),$(".owl-carousel.etCustServeMsgCarousel .item:gt(0)").css("display","block"),"Wishlist"==t&&$(function(){var t;$(".btn-wishlist").off("click"),$(".prod_wishlist_datalayer").attr("data-inwishlist","true"),ACC.product.bindWishlist(),e(),t=[],$(".prod_wishlist_datalayer").each(function(){var e=$(this).data("productcode").toString();t.push(e)}),localStorage.setItem("Wishlist",JSON.stringify(t)),$(".notInWishlist").hide()}),"PLP"==t&&e(),"Cart"==t){var g=[];if($('.item__quantity.hidden-xs.hidden-sm input[name="productCode"]').each(function(t){g.push($(this).val())}),!0===p){var h=$(".text-right.grand-total").text().trim().replace("£","").replace(".","");r='<klarna-placement data-key="credit-promotion-badge" data-locale="en-GB" data-purchase-amount="'+h+'"></klarna-placement>',$(".col-xs-12.col-sm-6.col-md-6.col-md-offset-2 .cart-totals").after(r),$(".col-xs-12.col-sm-6.col-md-6.col-md-offset-2 .cart-totals").css("margin-bottom","0"),$(".col-xs-12.col-sm-6.col-md-6.col-md-offset-2 .cart-totals .well").css("margin-bottom","0"),m()}!0===dataLayer.find(t=>"toyAppeal"===t.event).basketTagEnabled&&(a=document.getElementById("colorbox"),l=new MutationObserver(function(t){t.forEach(function(t){"style"===t.attributeName&&($("#colorbox, #cboxOverlay").remove(),setTimeout(function(){location.replace("/cart")},1e3))})}),o={attributes:!0,attributeFilter:["style"]},i=$(".cart__delivery--store").length,n=(s=g).indexOf("537996"),(0==i&&-1==n)!=(0==s.length)&&($(".taadd").prependTo(".cart-totals"),$(".taadd").css("display","inline-block"),$("#colorbox, #cboxOverlay").css("display","none!important"),$(".taadd #addToCartForm").click(function(t){l.observe(a,o);var e=ga.getAll()[0].get("name");ga(e+".send","event","Toy Appeal Donate","Basket Page CTA","Donate",{nonInteraction:!1})})),ACC.product.bindToAddToCartForm()),$(window).load(function(){$(".cartBottomContent.row .owl-item").on("click",function(){"the_entertainer_product_carousel_cart_carousel"==$(this).closest(".owl-carousel").attr("id")?ga("send","event","Cart Page Carousel","FreshRelevance"):ga("send","event","Cart Page Carousel","Entertainer")})}),"none"!=$(".basketTotal-below-threshold").css("display")&&ga("send","event","Click & Collect Threshold",$(".text-right.grand-total").text().trim().replace("£",""))}if("Payment"==t&&$(".payByGivexForm .submit_givexBalanceCheck").click(function(){var t=setInterval(function(){void 0===$(".payByGivexForm .subtotals .form-group.giftcardToPay .control input").attr("class")?(clearInterval(t),$(".payByGivexForm .subtotals .form-group.giftcardToPay .control input").addClass("form-control")):clearInterval(t)},1e3)}),"PDP"==t){if(!0===d)!function(t){var e='<klarna-placement data-key="credit-promotion-badge" data-locale="en-GB" data-purchase-amount="'+t+'"></klarna-placement>';$(".wishlistWrapper").before(e),m()}(h=$(".product-details.top-details .price").text().trim().replace("£","").replace(".",""));if(location.pathname.indexOf("537996")>-1)!0===dataLayer.find(t=>"toyAppeal"===t.event).enabled&&($(".taSteps").appendTo(".col-sm-12.col-md-7.col-lg-6"),$(".taSteps").css("display","block"),$(".taDesc").appendTo(".col-md-6.col-md-offset-3.col-lg-6.col-lg-offset-3:eq(0) .tabbody"),$(".taDesc").css("display","block"),$(".col-md-6.col-md-offset-3.col-lg-6.col-lg-offset-3:eq(0) .tabbody").css("padding","0"));$(".prod_wishlist").on("click",function(){var t=$(".prod_wishlist").children(".prod_wishlist_datalayer").data("productcode").toString();if("none"==$(".prod_wishlist").children(".btn-wishlist").children(".inWishlist").css("display"))null===localStorage.getItem("Wishlist")?((e=[]).push(t),localStorage.setItem("Wishlist",JSON.stringify(e))):((e=JSON.parse(localStorage.getItem("Wishlist"))).push(t),localStorage.setItem("Wishlist",JSON.stringify(e)));else if(null!=localStorage.getItem("Wishlist")){var e,a=(e=JSON.parse(localStorage.getItem("Wishlist"))).indexOf(t);a>-1&&(e.splice(a,1),localStorage.setItem("Wishlist",JSON.stringify(e)))}})}});
